# simple spectrum analyzer
Вы явно не раз и не два видели визуализатор музыки. Это такие прыгающие полосочки в такт музыки. И мне стало интересно, как оно работает. С целью написать минимально рабочую, но при этом +- понятную версию визуализатора я и написал этот простенький скрипт. 

## Режимы

### Режим волны выглядит так:
![](https://imgur.com/Ht68CsY.png)
![](https://imgur.com/obh5ai5.png)
### Режим частот выглядит так:
![](https://imgur.com/UsyDnAq.png)
![](https://imgur.com/cq0JYaf.png)
## Установка
Скачиваем проект, заходим в папку с файлами и прописываем:
> pip install -r requirements.txt

## Настройка
В файле **`configs.py`** есть все настройки. По дефолту стоят те, которые я подобрал во время тестов на глаз. Пройдёмся по ним:

 - `chunk`:  Эта переменная хранит в себе величину обрабатываемых за раз данных. Чем **больше** чанк - тем **меньше** скорость. Его **минимальный** объём - 1024 
 - `sample_rate`:  Хранит в себе количество сэмплов (измерений) звука в секунду. Чем больше - тем чётче, но медленней, по аналогии с чанком.
 - `wave_xlim, wave_ylim`:  Кратко говоря - длинна и высота графика, который построить matplotlib в режиме волны
 - `frequencies_xlim, frequencies_ylim`:  По аналогии с предыдущим пунктом, длинна и высота графика, но только в режиме частот 
 - `fft_filter_multiplayer`:  Множитель сглаживания графика для режима частот
 - `wave_filter_multiplayer`:  Множитель как и в предыдущим пункте, но вот только для режима волны

## Возможные улучшения
Я не профессионал и это нужно понимать, когда будете рыться в коде. 
Сто процентов есть куча мест, где можно оптимизировать код, ну или упростить его в понимании, тут как пойдёт.

Из того, что я заметил, так это то, что я, возможно плохо написал функцию fft. Я использую там некоторые фильтры, которые нормализуют fft, но и те не совсем помогают. Возможно это из-за  того, что чанк слишком маленький по дефолту, но если его увеличивать, то скорость падает (может это проблема только у меня?). Так же вся математика и вычисления легли на numpy, что выгодней по ресурсам, ведь numpy написан на C. В этом плане вычисления и так быстрые, но если есть возможность добиться лучшей скорости, то можете попробывать оптимизировать это

Конечно из того, что можно было оптимизировать, так это способ вывода. Выводить всё через matplotlib хоть и удобно, но не выгодно по ресурсам. В конце концов, эта библиотека не предназначалась для анимации. Если вы захотите перевести всё это дело в pyqt5 или что-то похожее, то флаг вам в руки. 

## Планы
~~1. Перевести проект с matplotlib на PyQt5 или QtGraphs, для более быстрого отображения информации.~~
План отменён из-за того, что я провёл тесты и понял, что мы упираемся не в движок mpl, а в вычисления. Чем мощнее комп - тем лучше. При увилечение чанка нуно увеличивать и sample rate, а fft функция ведёт себя странно при увеличении этих параметров.
В общем странно всё это. До тех пор, пока вычисления не будут ускорены, нет смысла переводить проект с mpl на qtgraphs. Да и возможностей mpl пока что хватает. Так что... 
1. Провести тесты и подобрать оптимальные настройки / найти узкое горлышко в коде и ускорить код.  

## Важно!
Проект воспринимает только микрофон, который стоит по умолчанию. Если хотите слушать звук с динамиков, то нужно поставить по умолчанию стерео микшер. С этой фичей проект работает нормально и без танцев с бубном только на винде, возможно.

